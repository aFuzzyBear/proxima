---
import XElement from 'astro-xelement'
import Fx from '../fx/fx.mjs'

const {
    type = 'h1',
    class: classList = '',
    style: styles = '',
    easing = 'linear',
    duration = 1500,
    fill = 'both',
    gradient = '',
    direction="alternate",
    iterations=1,
    delay="0",
    fullNode="true",
    animations="",
    trigger="click"
} = Astro.props;

const Fn = Fx
let animationX = {};
if ('' !== animations) {
    animationX = Fx.getAnimations(animations);
}

const animationTiming = {
    duration: parseInt(duration),
    easing: easing,
    fill: fill,
    direction: direction,
    iterations: parseInt(iterations),
    delay: parseInt(delay)
};

let styleSet = styles;
if ('' !== gradient) {
    styleSet = `
                background: linear-gradient(${gradient});
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
    ` + styles;
}
---

<XElement @is={type}
  style={styleSet}
  class={classList}
  define:vars={
    {
        Fn,
        delay: animationTiming.delay,
        fullNode,
        animationX,
        timing: animationTiming
    }
  }
  
  @visible={(event)=> {
      if (timing.iterations < 1) {
          timing.iterations = Infinity;
      }
      
      if ({} !== animationX) {
        if (true === JSON.parse(fullNode)) {
            event.target.animate(animationX, timing)
        } else {
            Fn.runSplitAnimations(event.target);
        }
      }
  }}
>
<slot/>
</XElement>